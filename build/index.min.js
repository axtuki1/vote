"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const express=require("express"),app=express(),config=require("config"),fs=require("fs"),bodyParser=require("body-parser");app.use(bodyParser.urlencoded({extended:!0})),app.use(bodyParser.json()),app.use(express.static("dist")),app.use("/js/obs",express.static("build/obs"));const router=express.Router();console.log("Loading webAPI module...."),fs.readdir("./build/api",(function(err,files){if(err)throw err;files.forEach(element=>{let name=element.slice(0,-3);Promise.resolve().then(()=>require("./api/"+name)).then(module=>{const api=new module[name];console.log("[WEBAPI] "+name+" is loaded. endpoint: /api/v1/"+name);let endpoint="/api/v1/"+name;"post"==api.type?router.post(endpoint,(req,res)=>api.response(req,res)):router.get(endpoint,(req,res)=>api.response(req,res))})})})),app.use(router),app.listen(config.serverPort,(function(){console.log("listening to PORT: "+config.serverPort)}));const server=require("ws").Server,s=new server({port:config.websocketPort}),wsApi={};console.log("Loading websocket module...."),fs.readdir("./build/wsApi",(function(err,files){if(err)throw err;files.forEach(element=>{let name=element.slice(0,-3);Promise.resolve().then(()=>require("./wsApi/"+name)).then(module=>{const api=new module[name];wsApi[name]=api,console.log("[WSAPI] "+name+" is loaded. ")})})})),s.on("connection",ws=>{ws.on("message",message=>{const data=JSON.parse(message);s.clients.forEach(client=>{client.send(JSON.stringify({mode:"update",target:data.target,text:data.text}))})}),ws.on("close",()=>{})});